
<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>README &#8212; pyuvm v3.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/bizstyle.css?v=9da9c8fd" />
    
    <script src="../_static/documentation_options.js?v=5773a0da"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/bizstyle.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="UVM and Python" href="UVM_and_Python.html" />
    <link rel="prev" title="pyuvm" href="../index.html" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <!--[if lt IE 9]>
    <script src="_static/css3-mediaqueries.js"></script>
    <![endif]-->
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="UVM_and_Python.html" title="UVM and Python"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="pyuvm"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyuvm v3.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">README</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="readme">
<h1>README<a class="headerlink" href="#readme" title="Link to this heading">¶</a></h1>
<section id="description">
<h2>Description<a class="headerlink" href="#description" title="Link to this heading">¶</a></h2>
<p><strong>pyuvm</strong> is the Universal Verification Methodology implemented in Python instead of SystemVerilog. <strong>pyuvm</strong> uses cocotb to interact with the simulator and schedule simulation events.</p>
<p><strong>pyuvm</strong> implements the most often-used parts of the UVM while taking advantage of the fact that Python does not have strict typing and does not require parameterized classes. The project refactors pieces of the UVM that were either overly complicated due to typing or legacy code.</p>
<p>The code is based in the IEEE 1800.2 specification and most classes and methods have the specification references in the comments.</p>
<p>The following IEEE 1800.2 sections have been implemented:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Section</p></th>
<th class="head"><p>Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>5</p></td>
<td><p>Base Classes</p></td>
<td><p>uvm_object does not capture transaction timing information</p></td>
</tr>
<tr class="row-odd"><td><p>6</p></td>
<td><p>Reporting Classes</p></td>
<td><p>Leverages logging, controlled using UVM hierarchy</p></td>
</tr>
<tr class="row-even"><td><p>8</p></td>
<td><p>Factory Classes</p></td>
<td><p>All uvm_void classes automatically registered</p></td>
</tr>
<tr class="row-odd"><td><p>9</p></td>
<td><p>Phasing</p></td>
<td><p>Simplified to only common phases. Supports objection system</p></td>
</tr>
<tr class="row-even"><td><p>12</p></td>
<td><p>UVM TLM Interfaces</p></td>
<td><p>Fully implemented</p></td>
</tr>
<tr class="row-odd"><td><p>13</p></td>
<td><p>Predefined Component Classes</p></td>
<td><p>Implements uvm_component with hierarchy, uvm_root singleton,run_test(), simplified ConfigDB, uvm_driver, etc</p></td>
</tr>
<tr class="row-even"><td><p>14 &amp; 15</p></td>
<td><p>Sequences, sequencer, sequence_item</p></td>
<td><p>Refactored sequencer functionality leveraging Python language capabilities. Simpler and more direct implementation</p></td>
</tr>
<tr class="row-odd"><td><p>17</p></td>
<td><p>UVM Regfister Enum</p></td>
<td><p>All the basic Enum types to be used in the whole PYUVM Ral</p></td>
</tr>
<tr class="row-even"><td><p>18</p></td>
<td><p>UVM Register Block</p></td>
<td><p>Main Register Block class</p></td>
</tr>
<tr class="row-odd"><td><p>19</p></td>
<td><p>UVM Register Field</p></td>
<td><p>Regsister Filed there are still few functionalities missing like atomic Backdoor access amd Field byte access or single Field access during read or write operation</p></td>
</tr>
<tr class="row-even"><td><p>20</p></td>
<td><p>UVM Register</p></td>
<td><p>Main register class, still missing Backdoor and used Backdoor to be leveraged from cocotb force. Byte access and single field access yet to be implemeneted</p></td>
</tr>
<tr class="row-odd"><td><p>21</p></td>
<td><p>UVM Register Map</p></td>
<td><p>Main register map class, should be refatored to guarantee simplicity and backdoor access, extension class in Read and Write to be implemeneted</p></td>
</tr>
<tr class="row-even"><td><p>22</p></td>
<td><p>UVM Memory</p></td>
<td><p>Not Implemented</p></td>
</tr>
<tr class="row-odd"><td><p>23</p></td>
<td><p>Register Item</p></td>
<td><p>Register Item used across multiple classes</p></td>
</tr>
<tr class="row-even"><td><p>24</p></td>
<td><p>Register include file</p></td>
<td><p>Includes other Enum and typeds to be merged with s17</p></td>
</tr>
<tr class="row-odd"><td><p>25</p></td>
<td><p>UVM register adapter</p></td>
<td><p>Main register adapter</p></td>
</tr>
<tr class="row-even"><td><p>26</p></td>
<td><p>UVM register predictor</p></td>
<td><p>Main register predictor, should be disabled if auto_prediction is not set</p></td>
</tr>
<tr class="row-odd"><td><p>27</p></td>
<td><p>Register Package</p></td>
<td><p>Main PKG if included and flake8 is not active should behave similarly to uvm_reg_pkg</p></td>
</tr>
</tbody>
</table>
<section id="installation">
<h3>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h3>
<p>You can install <strong>pyuvm</strong> using <code class="docutils literal notranslate"><span class="pre">pip</span></code>. This will also install <strong>cocotb</strong> as a requirement for <strong>pyuvm</strong>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>pyuvm
</pre></div>
</div>
<p>Then you can run a simple test:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span>python
&gt;&gt;&gt;<span class="w"> </span>from<span class="w"> </span>pyuvm<span class="w"> </span>import<span class="w"> </span>*
&gt;&gt;&gt;<span class="w"> </span><span class="nv">my_object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>uvm_object<span class="o">(</span><span class="s2">&quot;my_object&quot;</span><span class="o">)</span>
&gt;&gt;&gt;<span class="w"> </span>type<span class="o">(</span>my_object<span class="o">)</span>
&lt;class<span class="w"> </span><span class="s1">&#39;s05_base_classes.uvm_object&#39;</span>&gt;
&gt;&gt;&gt;<span class="w"> </span>print<span class="o">(</span><span class="s2">&quot;object name:&quot;</span>,<span class="w"> </span>my_object.get_name<span class="o">())</span>
object<span class="w"> </span>name:<span class="w"> </span>my_object
</pre></div>
</div>
</section>
<section id="running-from-the-repository">
<h3>Running from the repository<a class="headerlink" href="#running-from-the-repository" title="Link to this heading">¶</a></h3>
<p>You can run pyuvm from a cloned repository by installing the cloned repository using pip.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>&lt;pyuvm<span class="w"> </span>repo<span class="w"> </span>directory&gt;
%<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-e<span class="w"> </span>.
</pre></div>
</div>
</section>
</section>
<section id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Link to this heading">¶</a></h2>
<p>This section demonstrates running an example simulation and then shows how the example has been put together demonstrating what the UVM looks like in Python.</p>
<section id="running-the-simulation">
<h3>Running the simulation<a class="headerlink" href="#running-the-simulation" title="Link to this heading">¶</a></h3>
<p>The TinyALU is, as its name implies, a tiny ALU. It has four operations: ADD, AND, NOT, and MUL. This example shows us running the Verilog version of the design, but there is also a VHDL version.</p>
<p><strong>cocotb</strong> uses a Makefile to run its simulation. We see it in <code class="docutils literal notranslate"><span class="pre">examples/TinyALU</span></code>:</p>
<div class="highlight-makefile notranslate"><div class="highlight"><pre><span></span><span class="nv">CWD</span><span class="o">=</span><span class="k">$(</span>shell<span class="w"> </span><span class="nb">pwd</span><span class="k">)</span>
<span class="nv">COCOTB_REDUCED_LOG_FMT</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>True
<span class="nv">SIM</span><span class="w"> </span><span class="o">?=</span><span class="w"> </span>icarus
<span class="nv">VERILOG_SOURCES</span><span class="w"> </span><span class="o">=</span><span class="k">$(</span>CWD<span class="k">)</span>/hdl/verilog/tinyalu.sv
<span class="nv">MODULE</span><span class="w"> </span><span class="o">:=</span><span class="w"> </span>testbench
<span class="nv">TOPLEVEL</span><span class="o">=</span>tinyalu
<span class="nv">TOPLEVEL_LANG</span><span class="o">=</span>verilog
<span class="nv">COCOTB_HDL_TIMEUNIT</span><span class="o">=</span>1us
<span class="nv">COCOTB_HDL_TIMEPRECISION</span><span class="o">=</span>1us
<span class="cp">include $(shell cocotb-config --makefiles)/Makefile.sim</span>
</pre></div>
</div>
<p>You can learn more about the Makefile targets at <a class="reference external" href="https://docs.cocotb.org/en/stable/building.html">cocotb.org</a>.  The <code class="docutils literal notranslate"><span class="pre">cocotb-config</span></code> command on the last line points to the <strong>cocotb</strong> Makefile locations and launches the <code class="docutils literal notranslate"><span class="pre">sim</span></code> target.</p>
<p>Modify the <code class="docutils literal notranslate"><span class="pre">SIM</span></code> variable to match your simulator. All the simulator types are in <code class="docutils literal notranslate"><span class="pre">cocotb/share/makefiles/simulators/makefile.$(SIM)</span></code>.</p>
<p>You should be able to run the simulation like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>%<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>&lt;path&gt;/pyuvm/examples/TinyALU
%<span class="w"> </span>make<span class="w"> </span>sim
</pre></div>
</div>
<p><strong>cocotb</strong> will present a lot of messages, but in the middle of them you will see these UVM messages. It runs four examples with one for each command with randomized operands.</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>250000.00ns INFO     testbench.py(209)[uvm_test_top.env.scoreboard]: PASSED: 0x34 ADD 0x23 = 0x0057
250000.00ns INFO     testbench.py(209)[uvm_test_top.env.scoreboard]: PASSED: 0xf9 AND 0x29 = 0x0029
250000.00ns INFO     testbench.py(209)[uvm_test_top.env.scoreboard]: PASSED: 0x71 XOR 0x01 = 0x0070
250000.00ns INFO     testbench.py(209)[uvm_test_top.env.scoreboard]: PASSED: 0xb8 MUL 0x47 = 0x3308
250000.00ns INFO     testbench.py(209)[uvm_test_top.env.scoreboard]: PASSED: 0xff ADD 0xff = 0x01fe
250000.00ns INFO     testbench.py(209)[uvm_test_top.env.scoreboard]: PASSED: 0xff AND 0xff = 0x00ff
250000.00ns INFO     testbench.py(209)[uvm_test_top.env.scoreboard]: PASSED: 0xff XOR 0xff = 0x0000
250000.00ns INFO     testbench.py(209)[uvm_test_top.env.scoreboard]: PASSED: 0xff MUL 0xff = 0xfe01
</pre></div>
</div>
</section>
</section>
<section id="the-tinyalubfm-in-tinyalu-utils-py">
<h2>The <code class="docutils literal notranslate"><span class="pre">TinyAluBfm</span></code> in <code class="docutils literal notranslate"><span class="pre">tinyalu_utils.py</span></code><a class="headerlink" href="#the-tinyalubfm-in-tinyalu-utils-py" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">TinyAluBfm</span></code> is a singleton that uses <strong>cocotb</strong> to communicate with the TinyALU.  The BFM exposes three coroutines to the user: <code class="docutils literal notranslate"><span class="pre">send_op()</span></code>, <code class="docutils literal notranslate"><span class="pre">get_cmd()</span></code>, and <code class="docutils literal notranslate"><span class="pre">get_result()</span></code>.</p>
<p>The singleton uses the <code class="docutils literal notranslate"><span class="pre">cocotb.top</span></code> variable to get the handle to the DUT.  This is the handle that we normally pass to a <code class="docutils literal notranslate"><span class="pre">cocotb.test()</span></code> coroutine.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">TinyAluBfm</span></code> is defined in <code class="docutils literal notranslate"><span class="pre">tinyalu_utils.py</span></code> and imported into our testbench.</p>
</section>
<section id="the-pyuvm-testbench">
<h2>The <code class="docutils literal notranslate"><span class="pre">pyuvm</span></code> testbench<a class="headerlink" href="#the-pyuvm-testbench" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">testbench.py</span></code> contains the entire UVM testbench and connects to the TinyALU through a <code class="docutils literal notranslate"><span class="pre">TinyAluBfm</span></code> object defined in <code class="docutils literal notranslate"><span class="pre">tinyalu_utils.py</span></code>.  We’ll examine the <code class="docutils literal notranslate"><span class="pre">testbench.py</span></code> file and enough of the <strong>cocotb</strong> test too run the simlation</p>
<section id="importing-pyuvm">
<h3>Importing <code class="docutils literal notranslate"><span class="pre">pyuvm</span></code><a class="headerlink" href="#importing-pyuvm" title="Link to this heading">¶</a></h3>
<p>Testbenches written in the SystemVerilog UVM usually import the package like this:</p>
<div class="highlight-systemverilog notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">uvm_pkg::*</span><span class="p">;</span>
</pre></div>
</div>
<p>This gives you access to the class names without needing a package path.  To get
similar behavior with <code class="docutils literal notranslate"><span class="pre">pyuvm</span></code> us the <code class="docutils literal notranslate"><span class="pre">from</span></code> import syntax. We import <code class="docutils literal notranslate"><span class="pre">pyuvm</span></code> to distinguish the <code class="docutils literal notranslate"><span class="pre">&#64;pyuvm.test()</span></code> decorator from the <code class="docutils literal notranslate"><span class="pre">&#64;cocotb.test()</span></code> decorator:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pyuvm</span>
<span class="kn">from</span> <span class="nn">pyuvm</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</section>
<section id="the-alutest-classes">
<h3>The AluTest classes<a class="headerlink" href="#the-alutest-classes" title="Link to this heading">¶</a></h3>
<p>We’re going to examine the UVM classes from the top, the test, to the bottom, the sequences.</p>
<p><strong>pyuvm</strong> names the UVM classes as they are named in the specification. Therefore **pyvu use underscore naming as is done in SystemVerilog and not camel-casing.</p>
<p>We extend <code class="docutils literal notranslate"><span class="pre">uvm_test</span></code> to create the <code class="docutils literal notranslate"><span class="pre">AluTest</span></code>, using camel-casing in our code even if <strong>pyuvm</strong> does not use it:</p>
<p>You’ll see the following in the test:</p>
<ul class="simple">
<li><p>We define a class that extends <code class="docutils literal notranslate"><span class="pre">uvm_test</span></code>.</p></li>
<li><p>We use the <code class="docutils literal notranslate"><span class="pre">&#64;pyuvm.test()</span></code> decorator to notify <strong>cocotb</strong> that this is a test.</p></li>
<li><p>There is no <code class="docutils literal notranslate"><span class="pre">uvm_component_utils()</span></code> macro. <strong>pyuvm</strong> automatically registers classes that extend <code class="docutils literal notranslate"><span class="pre">uvm_void</span></code> with the factory.</p></li>
<li><p>The phases do not have a <code class="docutils literal notranslate"><span class="pre">phase</span></code> variable. Phasing has been refactored to support only the <em>common phases</em> as described in the specification.</p></li>
<li><p>We create the environment using the <code class="docutils literal notranslate"><span class="pre">create()</span></code> method and the factory. Notice that <code class="docutils literal notranslate"><span class="pre">create()</span></code> is now a simple class method. There is no typing-driven incantation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">raise_objection()</span></code> is now a <code class="docutils literal notranslate"><span class="pre">uvm_component</span></code> method. There is no longer a <code class="docutils literal notranslate"><span class="pre">phase</span></code> variable.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">ConfigDB()</span></code> singleton acts the same way as the <code class="docutils literal notranslate"><span class="pre">uvm_config_db</span></code> interface in the SystemVerilog UVM. <strong>pyuvm</strong> refactored away the <code class="docutils literal notranslate"><span class="pre">uvm_resource_db</span></code> as there are no issues with classes to manage.</p></li>
<li><p><strong>pyuvm</strong> leverages the Python logging system and does not implement the UVM reporting system. Every descendent of <code class="docutils literal notranslate"><span class="pre">uvm_report_object</span></code> has a <code class="docutils literal notranslate"><span class="pre">logger</span></code> data member.</p></li>
<li><p>Sequences work as they do in the SystemVerilog UVM.</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pyuvm</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">AluTest</span><span class="p">(</span><span class="n">uvm_test</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">build_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">env</span> <span class="o">=</span> <span class="n">AluEnv</span><span class="p">(</span><span class="s2">&quot;env&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">end_of_elaboration_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">test_all</span> <span class="o">=</span> <span class="n">TestAllSeq</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;test_all&quot;</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">run_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raise_objection</span><span class="p">()</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">test_all</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">drop_objection</span><span class="p">()</span>
</pre></div>
</div>
<p>We extend the <code class="docutils literal notranslate"><span class="pre">AluTest</span></code> class to create a parallel version of the test and a Fibonacci program. You can find these sequences in <code class="docutils literal notranslate"><span class="pre">testbench.py</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@pyuvm</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">ParallelTest</span><span class="p">(</span><span class="n">AluTest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">build_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">uvm_factory</span><span class="p">()</span><span class="o">.</span><span class="n">set_type_override_by_type</span><span class="p">(</span><span class="n">TestAllSeq</span><span class="p">,</span> <span class="n">TestAllForkSeq</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_phase</span><span class="p">()</span>

<span class="nd">@pyuvm</span><span class="o">.</span><span class="n">test</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">FibonacciTest</span><span class="p">(</span><span class="n">AluTest</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">build_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">ConfigDB</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;DISABLE_COVERAGE_ERRORS&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">uvm_factory</span><span class="p">()</span><span class="o">.</span><span class="n">set_type_override_by_type</span><span class="p">(</span><span class="n">TestAllSeq</span><span class="p">,</span> <span class="n">FibonacciSeq</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">build_phase</span><span class="p">()</span>


</pre></div>
</div>
<p>All the familiar pieces of a UVM testbench are in <strong>pyuvm</strong>.</p>
</section>
<section id="the-aluenv-class">
<h3>The ALUEnv Class<a class="headerlink" href="#the-aluenv-class" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">uvm_env</span></code> class is a container for the components that make up the testbench.  There are four component classes instantiated:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Monitor</span></code>—There are actually two monitors instantiated, one to monitor commands (<code class="docutils literal notranslate"><span class="pre">self.cmd_mod</span></code>) and the other to monitor results (<code class="docutils literal notranslate"><span class="pre">self.result_mon</span></code>).  The <code class="docutils literal notranslate"><span class="pre">Monitor</span></code> code is the same for both. We pass them the name of the proxy function that gets the data they monitor.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Scoreboard</span></code>—The scoreboard gathers all the commands and results and compares predicted results to actual results.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Coverage</span></code>—The coverage class checks that we’ve covered all the kinds of operations and issues an error if we did not.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Driver</span></code>—This <code class="docutils literal notranslate"><span class="pre">uvm_driver</span></code> processes sequences items.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">uvm_sequencer</span></code>—The <code class="docutils literal notranslate"><span class="pre">uvm_sequencer</span></code> queues sequence items and passes them to the <code class="docutils literal notranslate"><span class="pre">Driver</span></code></p></li>
<li><p>We store <code class="docutils literal notranslate"><span class="pre">self.seqr</span></code> in the <code class="docutils literal notranslate"><span class="pre">ConfigDB()</span></code> so test can get it as we see above.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">AluEnv</span></code> creates all these components in <code class="docutils literal notranslate"><span class="pre">build_phase()</span></code> and connects the exports to the ports in <code class="docutils literal notranslate"><span class="pre">connect_phase()</span></code>. The <code class="docutils literal notranslate"><span class="pre">build_phase()</span></code> is a top-down phase and the <code class="docutils literal notranslate"><span class="pre">connect_phase()</span></code> is a bottom up phase.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AluEnv</span><span class="p">(</span><span class="n">uvm_env</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">build_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seqr</span> <span class="o">=</span> <span class="n">uvm_sequencer</span><span class="p">(</span><span class="s2">&quot;seqr&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="n">ConfigDB</span><span class="p">()</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;SEQR&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span> <span class="o">=</span> <span class="n">Driver</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_mon</span> <span class="o">=</span> <span class="n">Monitor</span><span class="p">(</span><span class="s2">&quot;cmd_mon&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;get_cmd&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coverage</span> <span class="o">=</span> <span class="n">Coverage</span><span class="p">(</span><span class="s2">&quot;coverage&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scoreboard</span> <span class="o">=</span> <span class="n">Scoreboard</span><span class="p">(</span><span class="s2">&quot;scoreboard&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">connect_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">seq_item_port</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seqr</span><span class="o">.</span><span class="n">seq_item_export</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_mon</span><span class="o">.</span><span class="n">ap</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scoreboard</span><span class="o">.</span><span class="n">cmd_export</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_mon</span><span class="o">.</span><span class="n">ap</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coverage</span><span class="o">.</span><span class="n">analysis_export</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">ap</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">scoreboard</span><span class="o">.</span><span class="n">result_export</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="the-monitor">
<h3>The Monitor<a class="headerlink" href="#the-monitor" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Monitor</span></code> extends <code class="docutils literal notranslate"><span class="pre">uvm_component</span></code>. Takes the name of a <code class="docutils literal notranslate"><span class="pre">CocotProxy</span></code> method name as an argument.  It uses the name to find the method in the proxy and then calls the method. You cannot do this in SystemVerilog as there is no introspection.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Monitor</span></code> creates an analysis port and writes the data it gets into the analysis port.</p>
<p>Notice in the <code class="docutils literal notranslate"><span class="pre">run_phase()</span></code> we use the <code class="docutils literal notranslate"><span class="pre">await</span></code> keyword to wait for the <code class="docutils literal notranslate"><span class="pre">get_cmd</span></code> coroutine.  Unlike SystemVerilog, Python makes it clear when you are calling a time-consuming task vs a function. Also notice that the <code class="docutils literal notranslate"><span class="pre">run_phase()</span></code> has the <code class="docutils literal notranslate"><span class="pre">async</span></code> keyword to designate that it is a coroutine. (A task in SystemVerilog.)</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Monitor</span><span class="p">(</span><span class="n">uvm_component</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">method_name</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span> <span class="o">=</span> <span class="n">method_name</span>

    <span class="k">def</span> <span class="nf">build_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ap</span> <span class="o">=</span> <span class="n">uvm_analysis_port</span><span class="p">(</span><span class="s2">&quot;ap&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfm</span> <span class="o">=</span> <span class="n">TinyAluBfm</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bfm</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">method_name</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">run_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">datum</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_method</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;MONITORED </span><span class="si">{</span><span class="n">datum</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ap</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">datum</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="the-scoreboard">
<h3>The Scoreboard<a class="headerlink" href="#the-scoreboard" title="Link to this heading">¶</a></h3>
<p>The scoreboard receives commands from the command monitor and results from the results monitor in the same order.  It uses the commands to predict the results and compares them.</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">build_phase</span></code> uses <code class="docutils literal notranslate"><span class="pre">uvm_tlm_analysis_fifos</span></code> to receive data from the monitors and store it.</p></li>
<li><p>The scoreboard exposes the FIFO exports by copying them into class data members.  As we see in the environment above, this allows us to connect the exports without reaching into the <code class="docutils literal notranslate"><span class="pre">Scoreboard's</span></code> inner workings.</p></li>
<li><p>We connect the exports in the <code class="docutils literal notranslate"><span class="pre">connect_phase()</span></code></p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">check_phase()</span></code> runs after the <code class="docutils literal notranslate"><span class="pre">run_phase()</span></code>.  At this point the scoreboard has all operations and results. It loops through the operations and predicts the result, then it compares the predicted and actual result.</p></li>
<li><p>Notice that we do not use UVM reporting. Instead we us the Python <code class="docutils literal notranslate"><span class="pre">logging</span></code> module. Every <code class="docutils literal notranslate"><span class="pre">uvm_report_object</span></code> and its children has its own logger stored in <code class="docutils literal notranslate"><span class="pre">self.logger.</span></code></p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Scoreboard</span><span class="p">(</span><span class="n">uvm_component</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">build_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_fifo</span> <span class="o">=</span> <span class="n">uvm_tlm_analysis_fifo</span><span class="p">(</span><span class="s2">&quot;cmd_fifo&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_fifo</span> <span class="o">=</span> <span class="n">uvm_tlm_analysis_fifo</span><span class="p">(</span><span class="s2">&quot;result_fifo&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_get_port</span> <span class="o">=</span> <span class="n">uvm_get_port</span><span class="p">(</span><span class="s2">&quot;cmd_get_port&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_get_port</span> <span class="o">=</span> <span class="n">uvm_get_port</span><span class="p">(</span><span class="s2">&quot;result_get_port&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_export</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd_fifo</span><span class="o">.</span><span class="n">analysis_export</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_export</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_fifo</span><span class="o">.</span><span class="n">analysis_export</span>

    <span class="k">def</span> <span class="nf">connect_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cmd_get_port</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cmd_fifo</span><span class="o">.</span><span class="n">get_export</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">result_get_port</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">result_fifo</span><span class="o">.</span><span class="n">get_export</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">check_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_get_port</span><span class="o">.</span><span class="n">can_get</span><span class="p">():</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">actual_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">result_get_port</span><span class="o">.</span><span class="n">try_get</span><span class="p">()</span>
            <span class="n">cmd_success</span><span class="p">,</span> <span class="n">cmd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cmd_get_port</span><span class="o">.</span><span class="n">try_get</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">cmd_success</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;result </span><span class="si">{</span><span class="n">actual_result</span><span class="si">}</span><span class="s2"> had no command&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">op_numb</span><span class="p">)</span> <span class="o">=</span> <span class="n">cmd</span>
                <span class="n">op</span> <span class="o">=</span> <span class="n">Ops</span><span class="p">(</span><span class="n">op_numb</span><span class="p">)</span>
                <span class="n">predicted_result</span> <span class="o">=</span> <span class="n">alu_prediction</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">predicted_result</span> <span class="o">==</span> <span class="n">actual_result</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;PASSED: 0x</span><span class="si">{</span><span class="n">A</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> 0x</span><span class="si">{</span><span class="n">B</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2"> =&quot;</span>
                                     <span class="sa">f</span><span class="s2">&quot; 0x</span><span class="si">{</span><span class="n">actual_result</span><span class="si">:</span><span class="s2">04x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;FAILED: 0x</span><span class="si">{</span><span class="n">A</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> 0x</span><span class="si">{</span><span class="n">B</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2"> &quot;</span>
                                      <span class="sa">f</span><span class="s2">&quot;= 0x</span><span class="si">{</span><span class="n">actual_result</span><span class="si">:</span><span class="s2">04x</span><span class="si">}</span><span class="s2"> &quot;</span>
                                      <span class="sa">f</span><span class="s2">&quot;expected 0x</span><span class="si">{</span><span class="n">predicted_result</span><span class="si">:</span><span class="s2">04x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

</pre></div>
</div>
</section>
<section id="coverage">
<h3>Coverage<a class="headerlink" href="#coverage" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Coverage</span></code> Class extends <code class="docutils literal notranslate"><span class="pre">uvm_subscriber</span></code> which extends <code class="docutils literal notranslate"><span class="pre">uvm_analysis_export</span></code>.  As we see in the <code class="docutils literal notranslate"><span class="pre">AluEnv</span></code> above, this allows us to pass the object directly to the <code class="docutils literal notranslate"><span class="pre">connect()</span></code> method to connect it to an analysis port.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Coverage</span></code> Class overrides the <code class="docutils literal notranslate"><span class="pre">write()</span></code> method expected of a <code class="docutils literal notranslate"><span class="pre">uvm_subscriber</span></code>. If it didn’t you’d get a runtime error.  The <code class="docutils literal notranslate"><span class="pre">Coverage</span></code> class uses a set to store all the operations seen. Then it subtracts that from the set of all operations. If the result has a length longer than <code class="docutils literal notranslate"><span class="pre">0</span></code> it issues an error.</p>
<p>Since this tesbench loops through all the operations you will not see this error.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Coverage</span><span class="p">(</span><span class="n">uvm_subscriber</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">end_of_elaboration_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvg</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">):</span>
        <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span> <span class="o">=</span> <span class="n">cmd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cvg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">report_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">disable_errors</span> <span class="o">=</span> <span class="n">ConfigDB</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;DISABLE_COVERAGE_ERRORS&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">UVMConfigItemNotFound</span><span class="p">:</span>
            <span class="n">disable_errors</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">disable_errors</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">Ops</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Functional coverage error. Missed: </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">Ops</span><span class="p">)</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">cvg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">assert</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Covered all operations&quot;</span><span class="p">)</span>
                <span class="k">assert</span> <span class="kc">True</span>
</pre></div>
</div>
</section>
<section id="driver">
<h3>Driver<a class="headerlink" href="#driver" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Driver</span></code> extends <code class="docutils literal notranslate"><span class="pre">uvm_driver</span></code> and so it works with sequences and sequence items.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">connect_phase()</span></code> gets the proxy from the <code class="docutils literal notranslate"><span class="pre">ConfigDB()</span></code> and the <code class="docutils literal notranslate"><span class="pre">run_phase()</span></code> uses it to get items and process them by calling <code class="docutils literal notranslate"><span class="pre">send_op</span></code>.  We use <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True</span></code> because we do this forever. <strong>cocotb</strong> will shut down the <code class="docutils literal notranslate"><span class="pre">run_phase</span></code> coroutine at the end of simulation.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Driver</span><span class="p">(</span><span class="n">uvm_driver</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">build_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ap</span> <span class="o">=</span> <span class="n">uvm_analysis_port</span><span class="p">(</span><span class="s2">&quot;ap&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start_of_simulation_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfm</span> <span class="o">=</span> <span class="n">TinyAluBfm</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">launch_tb</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">bfm</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bfm</span><span class="o">.</span><span class="n">start_tasks</span><span class="p">()</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">run_phase</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">launch_tb</span><span class="p">()</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq_item_port</span><span class="o">.</span><span class="n">get_next_item</span><span class="p">()</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">bfm</span><span class="o">.</span><span class="n">send_op</span><span class="p">(</span><span class="n">cmd</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="n">cmd</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">cmd</span><span class="o">.</span><span class="n">op</span><span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">bfm</span><span class="o">.</span><span class="n">get_result</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ap</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="n">cmd</span><span class="o">.</span><span class="n">result</span> <span class="o">=</span> <span class="n">result</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">seq_item_port</span><span class="o">.</span><span class="n">item_done</span><span class="p">()</span>

</pre></div>
</div>
</section>
<section id="the-alu-sequence">
<h3>The ALU Sequence<a class="headerlink" href="#the-alu-sequence" title="Link to this heading">¶</a></h3>
<p>The ALU Sequence creates sequence items, randomizes them and sends them to the <code class="docutils literal notranslate"><span class="pre">Driver</span></code>. It inherits <code class="docutils literal notranslate"><span class="pre">start_item</span></code> and <code class="docutils literal notranslate"><span class="pre">finish_item</span></code> from <code class="docutils literal notranslate"><span class="pre">uvm_sequence</span></code>.</p>
<p>It is clear that <code class="docutils literal notranslate"><span class="pre">start_item</span></code> and <code class="docutils literal notranslate"><span class="pre">finish_item</span></code> block because we call them using the <code class="docutils literal notranslate"><span class="pre">await</span></code> keyword.  <code class="docutils literal notranslate"><span class="pre">start_item</span></code> waits for it’s turn to use the sequencer, and <code class="docutils literal notranslate"><span class="pre">finish_item</span></code> sends the sequence_item to the driver and returns when the driver calls <code class="docutils literal notranslate"><span class="pre">item_done()</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestAllSeq</span><span class="p">(</span><span class="n">uvm_sequence</span><span class="p">):</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">seqr</span> <span class="o">=</span> <span class="n">ConfigDB</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;SEQR&quot;</span><span class="p">)</span>
        <span class="n">random</span> <span class="o">=</span> <span class="n">RandomSeq</span><span class="p">(</span><span class="s2">&quot;random&quot;</span><span class="p">)</span>
        <span class="nb">max</span> <span class="o">=</span> <span class="n">MaxSeq</span><span class="p">(</span><span class="s2">&quot;max&quot;</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">random</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">seqr</span><span class="p">)</span>
        <span class="k">await</span> <span class="nb">max</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="n">seqr</span><span class="p">)</span>

</pre></div>
</div>
<p>This virtual sequence launches two other sequences: <code class="docutils literal notranslate"><span class="pre">RandomSeq</span></code> and <code class="docutils literal notranslate"><span class="pre">MaxSeq</span></code>. <code class="docutils literal notranslate"><span class="pre">RandomSeq</span></code> randomizes the operands.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RandomSeq</span><span class="p">(</span><span class="n">uvm_sequence</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Ops</span><span class="p">):</span>
            <span class="n">cmd_tr</span> <span class="o">=</span> <span class="n">AluSeqItem</span><span class="p">(</span><span class="s2">&quot;cmd_tr&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_item</span><span class="p">(</span><span class="n">cmd_tr</span><span class="p">)</span>
            <span class="n">cmd_tr</span><span class="o">.</span><span class="n">randomize_operands</span><span class="p">()</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish_item</span><span class="p">(</span><span class="n">cmd_tr</span><span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">MaxSeq</span></code> sets the operands to <code class="docutils literal notranslate"><span class="pre">0xff</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MaxSeq</span><span class="p">(</span><span class="n">uvm_sequence</span><span class="p">):</span>
    <span class="k">async</span> <span class="k">def</span> <span class="nf">body</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">op</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">Ops</span><span class="p">):</span>
            <span class="n">cmd_tr</span> <span class="o">=</span> <span class="n">AluSeqItem</span><span class="p">(</span><span class="s2">&quot;cmd_tr&quot;</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="mh">0xff</span><span class="p">,</span> <span class="n">op</span><span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_item</span><span class="p">(</span><span class="n">cmd_tr</span><span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">finish_item</span><span class="p">(</span><span class="n">cmd_tr</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="alu-sequence-item">
<h3>ALU Sequence Item<a class="headerlink" href="#alu-sequence-item" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">AluSeqItem</span></code> contains the TinyALU commands.  It has two operands and an operation.</p>
<p>The SystemVerilog <code class="docutils literal notranslate"><span class="pre">uvm_sequence_item</span></code> class uses <code class="docutils literal notranslate"><span class="pre">convert2string()</span></code> to convert the item to a string and <code class="docutils literal notranslate"><span class="pre">do_compare()</span></code> to compare the item to another item.  We do not use these in <strong>pyuvm</strong> because Python has magic methods that do these functions.</p>
<p><code class="docutils literal notranslate"><span class="pre">__eq__()</span></code>—This does the same thing as <code class="docutils literal notranslate"><span class="pre">do_compare()</span></code> It returns <code class="docutils literal notranslate"><span class="pre">True</span></code> if the items are equal.  This method works with the <code class="docutils literal notranslate"><span class="pre">==</span></code> operator.</p>
<p><code class="docutils literal notranslate"><span class="pre">__str__()</span></code>—This does the same thing as <code class="docutils literal notranslate"><span class="pre">convert2string()</span></code>.  It returns a string version of the item. The <code class="docutils literal notranslate"><span class="pre">print</span></code> function calls this method automatically.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">AluSeqItem</span><span class="p">(</span><span class="n">uvm_sequence_item</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">aa</span><span class="p">,</span> <span class="n">bb</span><span class="p">,</span> <span class="n">op</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">aa</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">bb</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="n">Ops</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">randomize_operands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">randomize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">randomize_operands</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">Ops</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="n">same</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">A</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">B</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">op</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">op</span>
        <span class="k">return</span> <span class="n">same</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span><span class="si">}</span><span class="s2"> : A: 0x</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">        OP: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">op</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">) B: 0x</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2">&quot;</span>

</pre></div>
</div>
<p>Now that we’ve got the UVM testbench we can call it from a <strong>cocotb</strong> test.</p>
</section>
</section>
<section id="the-cocotb-tests">
<h2>The Cocotb Tests<a class="headerlink" href="#the-cocotb-tests" title="Link to this heading">¶</a></h2>
<p><strong>cocotb</strong> finds <code class="docutils literal notranslate"><span class="pre">uvm_test</span></code> classes identified with the <code class="docutils literal notranslate"><span class="pre">&#64;pyuvm.test()</span></code> decorator and launches them as coroutines.  Our test does the following:</p>
</section>
<section id="contributing">
<h2>Contributing<a class="headerlink" href="#contributing" title="Link to this heading">¶</a></h2>
<p>You can contribute to <code class="docutils literal notranslate"><span class="pre">pyuvm</span></code> by forking this repository and submitting pull requests.</p>
<p>The repository runs all needed tests using <code class="docutils literal notranslate"><span class="pre">tox</span></code>.  The test runs
<code class="docutils literal notranslate"><span class="pre">flake8</span></code> and fails if that linter finds any issues.  Visual Studio Code
can be set up to automatically check <code class="docutils literal notranslate"><span class="pre">flake8</span></code> issues.  The repository
ignores F403 and F405 issues from <code class="docutils literal notranslate"><span class="pre">flake8</span></code>.</p>
<p>There are three sets of <code class="docutils literal notranslate"><span class="pre">pytest</span></code> tests that test features that
don’t use coroutines.  The rest of the tests are in <code class="docutils literal notranslate"><span class="pre">tests/cocotb_tests</span></code>
and need a simulator to run.</p>
<p>Credits:</p>
<ul class="simple">
<li><p>Ray Salemi—Original author, created as an employee of Siemens.</p></li>
<li><p>IEEE 1800.2 Specification</p></li>
<li><p>Siemens for supporting me in this effort.</p></li>
</ul>
</section>
<section id="license">
<h2>License<a class="headerlink" href="#license" title="Link to this heading">¶</a></h2>
<p>Copyright 2020 Siemens EDA</p>
<p>Licensed under the Apache License, Version 2.0 (the “License”);
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
<p><a class="reference external" href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an “AS IS” BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">README</a><ul>
<li><a class="reference internal" href="#description">Description</a><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#running-from-the-repository">Running from the repository</a></li>
</ul>
</li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#running-the-simulation">Running the simulation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-tinyalubfm-in-tinyalu-utils-py">The <code class="docutils literal notranslate"><span class="pre">TinyAluBfm</span></code> in <code class="docutils literal notranslate"><span class="pre">tinyalu_utils.py</span></code></a></li>
<li><a class="reference internal" href="#the-pyuvm-testbench">The <code class="docutils literal notranslate"><span class="pre">pyuvm</span></code> testbench</a><ul>
<li><a class="reference internal" href="#importing-pyuvm">Importing <code class="docutils literal notranslate"><span class="pre">pyuvm</span></code></a></li>
<li><a class="reference internal" href="#the-alutest-classes">The AluTest classes</a></li>
<li><a class="reference internal" href="#the-aluenv-class">The ALUEnv Class</a></li>
<li><a class="reference internal" href="#the-monitor">The Monitor</a></li>
<li><a class="reference internal" href="#the-scoreboard">The Scoreboard</a></li>
<li><a class="reference internal" href="#coverage">Coverage</a></li>
<li><a class="reference internal" href="#driver">Driver</a></li>
<li><a class="reference internal" href="#the-alu-sequence">The ALU Sequence</a></li>
<li><a class="reference internal" href="#alu-sequence-item">ALU Sequence Item</a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-cocotb-tests">The Cocotb Tests</a></li>
<li><a class="reference internal" href="#contributing">Contributing</a></li>
<li><a class="reference internal" href="#license">License</a></li>
</ul>
</li>
</ul>

  </div>
  <div>
    <h4>Previous topic</h4>
    <p class="topless"><a href="../index.html"
                          title="previous chapter">pyuvm</a></p>
  </div>
  <div>
    <h4>Next topic</h4>
    <p class="topless"><a href="UVM_and_Python.html"
                          title="next chapter">UVM and Python</a></p>
  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/docsources/README.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="UVM_and_Python.html" title="UVM and Python"
             >next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="pyuvm"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">pyuvm v3.0.0 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">README</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2020, Ray Salemi.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.3.7.
    </div>
  </body>
</html>